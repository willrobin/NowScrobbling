<?xml version="1.0"?>
<ruleset name="NowScrobbling">
    <description>PHP CodeSniffer rules for NowScrobbling WordPress Plugin</description>

    <!-- What to scan -->
    <file>src</file>
    <file>nowscrobbling.php</file>
    <file>uninstall.php</file>
    <file>tests</file>

    <!-- Exclude vendor and node_modules -->
    <exclude-pattern>*/vendor/*</exclude-pattern>
    <exclude-pattern>*/node_modules/*</exclude-pattern>
    <exclude-pattern>*/.phpunit.cache/*</exclude-pattern>

    <!-- Show progress and sniff codes -->
    <arg value="ps"/>
    <arg name="colors"/>
    <arg name="extensions" value="php"/>

    <!-- PHP 8.2+ compatibility -->
    <config name="testVersion" value="8.2-"/>
    <rule ref="PHPCompatibilityWP"/>

    <!-- WordPress Coding Standards -->
    <rule ref="WordPress">
        <!-- Allow short array syntax -->
        <exclude name="Universal.Arrays.DisallowShortArraySyntax"/>

        <!-- Allow PSR-4 file naming -->
        <exclude name="WordPress.Files.FileName"/>

        <!-- Allow constructor property promotion -->
        <exclude name="Squiz.Functions.MultiLineFunctionDeclaration.SpaceAfterBracket"/>

        <!-- Allow arrow functions -->
        <exclude name="Squiz.Functions.FunctionDeclarationArgumentSpacing"/>
    </rule>

    <!-- WordPress Extra for modern WordPress development -->
    <rule ref="WordPress-Extra">
        <!-- Allow short echo tags in views -->
        <exclude name="Generic.PHP.DisallowShortOpenTag.EchoFound"/>
    </rule>

    <!-- WordPress Docs - require documentation -->
    <rule ref="WordPress-Docs">
        <!-- Allow undocumented short closures -->
        <exclude name="Squiz.Commenting.FunctionComment.Missing"/>
    </rule>

    <!-- Additional modern PHP rules -->
    <rule ref="SlevomatCodingStandard.TypeHints">
        <exclude name="SlevomatCodingStandard.TypeHints.DisallowMixedTypeHint"/>
        <exclude name="SlevomatCodingStandard.TypeHints.DisallowArrayTypeHintSyntax"/>
    </rule>

    <!-- Require strict types declaration -->
    <rule ref="SlevomatCodingStandard.TypeHints.DeclareStrictTypes">
        <properties>
            <property name="spacesCountAroundEqualsSign" value="0"/>
        </properties>
    </rule>

    <!-- Disallow unused variables -->
    <rule ref="SlevomatCodingStandard.Variables.UnusedVariable">
        <properties>
            <property name="ignoreUnusedValuesWhenOnlyKeysAreUsedInForeach" value="true"/>
        </properties>
    </rule>

    <!-- Force array shorthand -->
    <rule ref="Generic.Arrays.DisallowLongArraySyntax"/>

    <!-- Require Yoda conditions (WordPress standard) -->
    <rule ref="WordPress.PHP.YodaConditions"/>

    <!-- Allow match expressions -->
    <rule ref="Generic.WhiteSpace.ScopeIndent">
        <properties>
            <property name="exact" value="false"/>
        </properties>
    </rule>

    <!-- Minimum WordPress version for function usage -->
    <config name="minimum_wp_version" value="6.0"/>

    <!-- Text domain for i18n -->
    <rule ref="WordPress.WP.I18n">
        <properties>
            <property name="text_domain" type="array">
                <element value="nowscrobbling"/>
            </property>
        </properties>
    </rule>

    <!-- Prefix for global functions and variables -->
    <rule ref="WordPress.NamingConventions.PrefixAllGlobals">
        <properties>
            <property name="prefixes" type="array">
                <element value="nowscrobbling"/>
                <element value="ns_"/>
                <element value="NowScrobbling"/>
            </property>
        </properties>
    </rule>
</ruleset>
